tinymce.PluginManager.add('axupimgs', function(editor, url) {
	var pluginName='Ax多图片上传';
	window.axupimgs={}; //扔外部公共变量，也可以扔一个自定义的位置

	var baseURL=tinymce.baseURL;
	var iframe1 = baseURL+'/plugins/axupimgs/upfiles.html';
    axupimgs.images_upload_handler = editor.getParam('images_upload_handler', undefined, 'function');
    axupimgs.images_upload_base_path = editor.getParam('images_upload_base_path', '', 'string');
    axupimgs.axupimgs_filetype = editor.getParam('axupimgs_filetype', '.png,.gif,.jpg,.jpeg', 'string');
	axupimgs.res=[];
	var openDialog = function() {
		return editor.windowManager.openUrl({
			title: pluginName,
			size: 'large',
			url:iframe1,
			buttons: [
				{
					type: 'cancel',
					text: 'Close'
				},
				{
					type: 'custom',
					text: 'Save',
					name: 'save',
					primary: true
				},
			],
			onAction: function (api, details) {
				switch (details.name) {
					case 'save':
						var html = '';
						var imgs = axupimgs.res;
						var len = imgs.length;
						for(let i=0;i<len;i++){
							if( imgs[i].url ){
								html += '<img src="'+imgs[i].url+'" />';
							}
						}
						editor.insertContent(html);
						axupimgs.res=[];
						api.close();
						break;
					default:
						break;
				}

			}
		});
	};

	editor.ui.registry.getAll().icons.axupimgs || editor.ui.registry.addIcon('axupimgs','<svg t="1610344185822" class="icon" viewBox="0 0 1280 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="908" width="24" height="24"><path d="M1074.5797743 747.37109375V138.9921875c0-21.09375001-19.86328125-76.37695313-73.38867188-76.37695313H158.14422742C97.67547742 62.61523437 84.75555555 117.98632812 84.75555555 139.08007812v608.20312501c0 31.81640625 25.6640625 78.83789063 73.38867188 78.83789062l843.13476563-1.14257813c45.43945313 0 73.38867188-37.35351563 73.38867187-77.60742187z m-917.578125 3.515625V137.84960937h845.15625001v612.94921875H157.0016493v0.08789063z" p-id="909"></path><path d="M614.7360243 467.703125l-71.98242188-83.75976563L359.8532118 615.53515625l-75.41015625-72.94921875-109.6875 149.4140625h765v-149.4140625L759.9313368 268.71874999 614.82391493 467.703125zM334.8922743 377a92.63671875 92.63671875 0 0 0 64.59960938-26.3671875c17.13867188-16.78710938 26.63085938-39.55078125 26.54296875-63.10546875 0-49.921875-40.34179689-90.52734375-89.99999999-90.52734375-49.74609375 0-90 40.51757813-90 90.52734375-0.08789063 50.00976563 39.11132813 89.47265625 88.85742186 89.47265625z" p-id="910"></path><path d="M1138.8437934 219.75555555l-0.26367187 588.25195313s11.86523438 100.10742188-59.23828126 100.10742187H221.17777777c0 21.18164063 21.00585938 76.640625 73.38867189 76.640625h843.13476562c51.24023438 0 73.4765625-43.50585938 73.47656249-79.01367187V296.39618055c-0.08789063-36.73828125-39.46289063-76.640625-72.33398438-76.640625z" p-id="911"></path></svg>');

	editor.ui.registry.addButton('axupimgs', {
		icon: 'axupimgs',
        tooltip: pluginName,
		onAction: function() {
			openDialog();
		}
	});
	editor.ui.registry.addMenuItem('axupimgs', {
		icon: 'axupimgs',
		text: '图片批量上传...',
		onAction: function() {
			openDialog();
		}
	});
	return {
		getMetadata: function() {
			return  {
				name: pluginName,
				url: "http://tinymce.ax-z.cn/more-plugins/axupimgs.php",
			};
		}
	};
});
